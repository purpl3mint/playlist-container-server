# Playlist container server
## Описание
Данное веб-приложение является частью системы управления мультимедийным контентом. Основную ее часть можно найти по ссылке https://github.com/purpl3mint/schedule-editor-web  
В приложении реализован сервер хранения мультимедийного контента  
Стек технологий: Node.js + Express.js + PostgreSQL + React.js  

## Установка
### Node.js
Для установки приложения необходимо установить Node.js версии не ниже 14.  
Установка для Windows: на сайте https://nodejs.org/en/ скачать версию LTS и установить через .msi пакет  
Установка для Ubuntu 16.04: необходимо выполнить следующие команды в консоли  
    `curl -sL https://deb.nodesource.com/setup_14.x -o nodesource_setup.sh`  
    `sudo bash nodesource_setup.sh`  
    `sudo apt-get install nodejs`  
Для проверки корректности установки Node можно выполнить команду  
    `node -v`  
Результатом команды будет версия установленного пакета Node.js.  

### PM2
Устанавливаем глобально PM2 (если не установлен) для контроля работоспособности приложения. В Ubuntu 16.04 выполняется это командой  
    `sudo npm i -g pm2`  
В Windows  
    `npm i -g pm2`  

### PostgreSQL
Установка для Windows довольно простая - скачиваем на официальном сайте установщик для версии 10. Задаем все необходимые настройки, логины и пароли.
После установки в pgAdmin создаем таблицу "content-server" или любую другую. Ее название пригодится на этапе конфигурирования сервера. На этом настройка завершена.  
Для Ubuntu 16.04 устанавливаем командой  
    `sudo apt install postgresql postgresql-contrib -y`  
Создаем нового пользователя  
    `sudo -i -u postgres`  
    `createuser --interactive`  
    `/вводим имя нового пользователя/`  
    `/задаем как суперпаользователя через "y"/`  

Создаем новую базу данных  
    `create database 'content-server'`  

Добавляем пользователя в базу данных  
    `psql -d 'content-server'`  
    `ALTER USER (username) PASSWORD 'пароль';`  

### Установка приложения
Далее требуется клонировать текущий репозиторий в любую удобную папку. Это можно выполнить командой  
    `git clone https://github.com/purpl3mint/content-server.git`  
После клонирования переходим в папку проекта командой  
    `cd content-server`  
Далее требуется установить модули Node.js для сервера командой  
    `npm i`  
Также модули должны быть установлены для клиента. Переходим в папку client  
    `cd client`  
И в ней также выполняем команду  
    `npm i`  

## Конфигурирование
### Настройка сервера
Из корневой папки проекта откроем файл конфигурации  
    `nano config/production.json`  
В этом файле указываем порт, на котором будет запущено приложение (рекомендуется 8082). Также прописываем все параметры базы данных для приложения (название, логин, пароль, хост и порт сервера базы данных). Также необходимо задать секретный ключ для хэширования паролей в базе данных.  
### Настройка клиента
Из корневой папки проекта откроем файл конфигурации  
    `nano client/src/utils/Config.js`  
В нем требуется прописать URL данного приложения для корректного отображения данных.
После сохранения URL выполняется сборка клиентской части командой  
    `npm run client:build`  

## Запуск приложения
Без pm2 приложение не запускаем, иначе может упасть и придется поднимать вручную. pm2 будет за этим следить. 
Сначала создадим задачу на запуск приложения. В корневой папке приложения вводим команду  
    `sudo pm2 start npm -- name "app-name" -- start`  
После этого будет создан процесс app-name. Остановить его можно командой  
    `sudo pm2 stop "app-name"`  
Повторно запускается командой  
    `sudo pm2 start "app-name"`  
Проверить статус всех существующих процессов можно командой  
    `sudo pm2 list`  

Если для pm2 не был настроен автозапуск, то нужно выполнить команду  
    `sudo pm2 startup`  
Он либо автоматом настроится, либо попросит ввести некоторую строку вида  
    `sudo env PATH=$...`  

